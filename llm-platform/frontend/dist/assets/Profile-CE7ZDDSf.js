import{u as T}from"./index-DzVZk42n.js";import{a as G}from"./apiKeys-CluY4eWM.js";import{c as E,i as O}from"./index-DcR-k5ux.js";import{R as c,O as y}from"./element-plus-CLNn8XtP.js";import{k as j,r as V,M as C,d as H,l as J,q as s,G as a,A as l,a8 as d,u as i,E as b,m as L}from"./vue-vendor-CBcJ4V7k.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"profile-page"},X={class:"profile-content"},Z={class:"user-info"},$={class:"avatar-section"},ee={class:"user-details"},se={class:"stats-grid"},ae={class:"stat-item"},le={class:"stat-value"},oe={class:"stat-item"},re={class:"stat-value"},te={class:"stat-item"},ne={class:"stat-value"},de=j({__name:"Profile",setup(ie){const u=T(),h=V(!1),x=V(!1),g=V(),v=V(),t=C({username:"",email:"",full_name:"",description:""}),m=C({password:"",confirmPassword:""}),F=C({apiKeysCount:0}),M=(o,e,n)=>{e&&!O(e)?n(new Error("请输入正确的邮箱地址")):n()},R=(o,e,n)=>{e!==m.password?n(new Error("两次输入的密码不一致")):n()},k={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度在 3 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:M,trigger:"blur"}],full_name:[{max:100,message:"姓名长度不能超过 100 个字符",trigger:"blur"}],description:[{max:500,message:"描述长度不能超过 500 个字符",trigger:"blur"}]},K={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少需蝨6位字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:R,trigger:"blur"}]},U=()=>{const o=u.user;o&&(t.username=o.username,t.email=o.email,t.full_name=o.full_name||"",t.description=o.description||"")},q=()=>{var o;U(),(o=g.value)==null||o.clearValidate()},D=async()=>{g.value&&await g.value.validate(async o=>{if(o)try{h.value=!0,y.success("个人资料已更新")}catch(e){y.error(e.message||"更新失败")}finally{h.value=!1}})},S=async()=>{v.value&&await v.value.validate(async o=>{var e;if(o)try{x.value=!0,y.success("密码已修改"),m.password="",m.confirmPassword="",(e=v.value)==null||e.resetFields()}catch(n){y.error(n.message||"密码修改失败")}finally{x.value=!1}})},z=async()=>{try{const o=await G.getApiKeys();F.apiKeysCount=o.length}catch(o){console.error("Failed to load stats:",o)}};return H(async()=>{U(),await z()}),(o,e)=>{const n=d("User"),B=d("el-icon"),N=d("el-avatar"),I=d("el-tag"),w=d("el-card"),f=d("el-input"),p=d("el-form-item"),P=d("el-button"),Y=d("el-form");return L(),J("div",W,[e[16]||(e[16]=s("div",{class:"page-header"},[s("h1",null,"个人资料"),s("p",null,"管理您的个人信息和账户设置")],-1)),s("div",X,[a(w,{class:"user-info-card",shadow:"never"},{header:l(()=>e[6]||(e[6]=[s("div",{class:"card-header"},[s("span",null,"基本信息")],-1)])),default:l(()=>{var r,_,A;return[s("div",Z,[s("div",$,[a(N,{size:80},{default:l(()=>[a(B,{size:"40"},{default:l(()=>[a(n)]),_:1})]),_:1}),s("div",ee,[s("h3",null,c(((r=i(u).user)==null?void 0:r.full_name)||((_=i(u).user)==null?void 0:_.username)),1),s("p",null,c((A=i(u).user)==null?void 0:A.email),1),a(I,{type:i(u).isAdmin?"danger":"primary",size:"small"},{default:l(()=>[b(c(i(u).isAdmin?"管理员":"普通用户"),1)]),_:1},8,["type"])])])])]}),_:1}),a(w,{shadow:"never"},{header:l(()=>e[7]||(e[7]=[s("div",{class:"card-header"},[s("span",null,"编辑资料")],-1)])),default:l(()=>[a(Y,{ref_key:"profileFormRef",ref:g,model:t,rules:k,"label-width":"100px",class:"profile-form"},{default:l(()=>[a(p,{label:"用户名",prop:"username"},{default:l(()=>[a(f,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=r=>t.username=r),placeholder:"请输入用户名",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(p,{label:"邮箱",prop:"email"},{default:l(()=>[a(f,{modelValue:t.email,"onUpdate:modelValue":e[1]||(e[1]=r=>t.email=r),type:"email",placeholder:"请输入邮箱",maxlength:"255"},null,8,["modelValue"])]),_:1}),a(p,{label:"姓名",prop:"full_name"},{default:l(()=>[a(f,{modelValue:t.full_name,"onUpdate:modelValue":e[2]||(e[2]=r=>t.full_name=r),placeholder:"请输入姓名",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(p,{label:"个人描述",prop:"description"},{default:l(()=>[a(f,{modelValue:t.description,"onUpdate:modelValue":e[3]||(e[3]=r=>t.description=r),type:"textarea",rows:3,placeholder:"请输入个人描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(p,null,{default:l(()=>[a(P,{type:"primary",loading:h.value,onClick:D},{default:l(()=>e[8]||(e[8]=[b(" 保存修改 ")])),_:1,__:[8]},8,["loading"]),a(P,{onClick:q},{default:l(()=>e[9]||(e[9]=[b(" 重置 ")])),_:1,__:[9]})]),_:1})]),_:1},8,["model"])]),_:1}),a(w,{shadow:"never"},{header:l(()=>e[10]||(e[10]=[s("div",{class:"card-header"},[s("span",null,"修改密码")],-1)])),default:l(()=>[a(Y,{ref_key:"passwordFormRef",ref:v,model:m,rules:K,"label-width":"100px",class:"password-form"},{default:l(()=>[a(p,{label:"新密码",prop:"password"},{default:l(()=>[a(f,{modelValue:m.password,"onUpdate:modelValue":e[4]||(e[4]=r=>m.password=r),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(p,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(f,{modelValue:m.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=r=>m.confirmPassword=r),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1}),a(p,null,{default:l(()=>[a(P,{type:"primary",loading:x.value,onClick:S},{default:l(()=>e[11]||(e[11]=[b(" 修改密码 ")])),_:1,__:[11]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),a(w,{shadow:"never"},{header:l(()=>e[12]||(e[12]=[s("div",{class:"card-header"},[s("span",null,"账户统计")],-1)])),default:l(()=>{var r,_;return[s("div",se,[s("div",ae,[s("div",le,c(F.apiKeysCount),1),e[13]||(e[13]=s("div",{class:"stat-label"},"API 密钥",-1))]),s("div",oe,[s("div",re,c(i(E)(((r=i(u).user)==null?void 0:r.created_at)||"","YYYY-MM-DD")),1),e[14]||(e[14]=s("div",{class:"stat-label"},"注册时间",-1))]),s("div",te,[s("div",ne,c(i(E)(((_=i(u).user)==null?void 0:_.updated_at)||"","YYYY-MM-DD")),1),e[15]||(e[15]=s("div",{class:"stat-label"},"最后更新",-1))])])]}),_:1})])])}}}),ge=Q(de,[["__scopeId","data-v-d6aa84c1"]]);export{ge as default};
