import{a as g}from"./apiKeys-CluY4eWM.js";import{f as re,a as ce,c as T,e as _e}from"./index-DcR-k5ux.js";import{O as r,R as c,S as K}from"./element-plus-CLNn8XtP.js";import{k as ue,r as _,M as me,d as pe,l as w,q as i,G as t,A as a,a8 as s,E as d,z as $,u as P,C as fe,m}from"./vue-vendor-CBcJ4V7k.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DzVZk42n.js";const ye={class:"api-keys-page"},we={class:"page-header"},ge={class:"header-actions"},ke={key:0,class:"loading"},xe={class:"key-name"},Ae={class:"key-prefix"},be={key:0},Pe={key:1,class:"text-placeholder"},Ie={key:0},he={key:1,class:"text-placeholder"},Ve={class:"dialog-footer"},De={class:"key-display"},Ce={class:"key-container"},Ye={class:"key-value"},Me={class:"dialog-footer"},Be=ue({__name:"ApiKeys",setup(Ee){const I=_(!1),h=_(!1),f=_(!1),k=_(!1),v=_(!1),Y=_([]),V=_(""),x=_(null),A=_(),n=me({name:"",expires_at:void 0,is_active:!0}),N={name:[{required:!0,message:"请输入 API 密钥名称",trigger:"blur"},{min:1,max:100,message:"名称长度在 1 到 100 个字符",trigger:"blur"}]},R=o=>o.getTime()<Date.now(),b=async()=>{try{I.value=!0,Y.value=await g.getApiKeys()}catch(o){r.error("获取 API 密钥列表失败"),console.error("Failed to load API keys:",o)}finally{I.value=!1}},M=()=>{v.value=!1,f.value=!0},U=o=>{v.value=!0,x.value=o,n.name=o.name,n.expires_at=o.expires_at||void 0,n.is_active=o.is_active,f.value=!0},F=()=>{var o;n.name="",n.expires_at=void 0,n.is_active=!0,x.value=null,(o=A.value)==null||o.resetFields()},H=async()=>{A.value&&await A.value.validate(async o=>{if(o)try{if(h.value=!0,v.value&&x.value)await g.updateApiKey(x.value.id,{name:n.name,is_active:n.is_active}),r.success("API 密钥已更新");else{const e=await g.createApiKey({name:n.name,expires_at:n.expires_at});V.value=e.key,k.value=!0,r.success("API 密钥创建成功")}f.value=!1,await b()}catch(e){r.error(e.message||"操作失败")}finally{h.value=!1}})},S=async({action:o,key:e})=>{switch(o){case"edit":U(e);break;case"toggle":await z(e);break;case"delete":await q(e);break}},z=async o=>{try{await K.confirm(`确定要${o.is_active?"停用":"启用"} API 密钥 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.updateApiKey(o.id,{is_active:!o.is_active}),r.success(`API 密钥已${o.is_active?"停用":"启用"}`),await b()}catch(e){e!=="cancel"&&r.error("操作失败")}},q=async o=>{try{await K.confirm(`确定要删除 API 密钥 "${o.name}" 吗？此操作不可恢复。`,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}),await g.deleteApiKey(o.id),r.success("API 密钥已删除"),await b()}catch(e){e!=="cancel"&&r.error("删除失败")}},L=async()=>{await _e(V.value)?r.success("API 密钥已复制到剪贴板"):r.error("复制失败")};return pe(async()=>{await b()}),(o,e)=>{const G=s("Plus"),y=s("el-icon"),p=s("el-button"),O=s("el-skeleton"),u=s("el-table-column"),j=s("el-tag"),J=s("More"),Q=s("Switch"),D=s("el-dropdown-item"),W=s("Edit"),X=s("Delete"),Z=s("el-dropdown-menu"),ee=s("el-dropdown"),te=s("el-empty"),ae=s("el-table"),le=s("el-card"),B=s("el-input"),C=s("el-form-item"),oe=s("el-date-picker"),se=s("el-switch"),ne=s("el-form"),E=s("el-dialog"),ie=s("el-alert"),de=s("DocumentCopy");return m(),w("div",ye,[i("div",we,[e[8]||(e[8]=i("div",{class:"header-content"},[i("h1",null,"API 密钥管理"),i("p",null,"创建和管理您的 API 密钥，用于访问 LLM Platform API")],-1)),i("div",ge,[t(p,{type:"primary",onClick:M},{default:a(()=>[t(y,null,{default:a(()=>[t(G)]),_:1}),e[7]||(e[7]=d(" 创建 API 密钥 "))]),_:1,__:[7]})])]),t(le,{shadow:"never"},{default:a(()=>[I.value?(m(),w("div",ke,[t(O,{rows:5,animated:""})])):(m(),$(ae,{key:1,data:Y.value,style:{width:"100%"},"row-key":"id"},{empty:a(()=>[t(te,{description:"暂无 API 密钥"},{default:a(()=>[t(p,{type:"primary",onClick:M},{default:a(()=>e[11]||(e[11]=[d(" 创建第一个 API 密钥 ")])),_:1,__:[11]})]),_:1})]),default:a(()=>[t(u,{prop:"name",label:"名称","min-width":"150"},{default:a(({row:l})=>[i("div",xe,[i("strong",null,c(l.name),1)])]),_:1}),t(u,{prop:"key_prefix",label:"密钥","min-width":"200"},{default:a(({row:l})=>[i("div",Ae,[i("code",null,c(l.key_prefix),1)])]),_:1}),t(u,{prop:"is_active",label:"状态",width:"100"},{default:a(({row:l})=>[t(j,{type:l.is_active?"success":"danger",size:"small"},{default:a(()=>[d(c(l.is_active?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"usage_count",label:"使用次数",width:"120"},{default:a(({row:l})=>[d(c(P(re)(l.usage_count)),1)]),_:1}),t(u,{prop:"last_used_at",label:"最后使用",width:"160"},{default:a(({row:l})=>[l.last_used_at?(m(),w("span",be,c(P(ce)(l.last_used_at)),1)):(m(),w("span",Pe,"未使用"))]),_:1}),t(u,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:l})=>[d(c(P(T)(l.created_at,"YYYY-MM-DD")),1)]),_:1}),t(u,{prop:"expires_at",label:"过期时间",width:"160"},{default:a(({row:l})=>[l.expires_at?(m(),w("span",Ie,c(P(T)(l.expires_at,"YYYY-MM-DD")),1)):(m(),w("span",he,"永不过期"))]),_:1}),t(u,{label:"操作",width:"120",fixed:"right"},{default:a(({row:l})=>[t(ee,{onCommand:S},{dropdown:a(()=>[t(Z,null,{default:a(()=>[t(D,{command:{action:"toggle",key:l}},{default:a(()=>[t(y,null,{default:a(()=>[t(Q)]),_:1}),d(" "+c(l.is_active?"停用":"启用"),1)]),_:2},1032,["command"]),t(D,{command:{action:"edit",key:l}},{default:a(()=>[t(y,null,{default:a(()=>[t(W)]),_:1}),e[9]||(e[9]=d(" 编辑 "))]),_:2,__:[9]},1032,["command"]),t(D,{command:{action:"delete",key:l},class:"danger-item",divided:""},{default:a(()=>[t(y,null,{default:a(()=>[t(X)]),_:1}),e[10]||(e[10]=d(" 删除 "))]),_:2,__:[10]},1032,["command"])]),_:2},1024)]),default:a(()=>[t(p,{size:"small",text:""},{default:a(()=>[t(y,null,{default:a(()=>[t(J)]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"]))]),_:1}),t(E,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),title:v.value?"编辑 API 密钥":"创建 API 密钥",width:"500px",onClose:F},{footer:a(()=>[i("div",Ve,[t(p,{onClick:e[3]||(e[3]=l=>f.value=!1)},{default:a(()=>e[12]||(e[12]=[d("取消")])),_:1,__:[12]}),t(p,{type:"primary",loading:h.value,onClick:H},{default:a(()=>[d(c(v.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(ne,{ref_key:"formRef",ref:A,model:n,rules:N,"label-width":"80px"},{default:a(()=>[t(C,{label:"名称",prop:"name"},{default:a(()=>[t(B,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=l=>n.name=l),placeholder:"请输入 API 密钥名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(C,{label:"过期时间",prop:"expires_at"},{default:a(()=>[t(oe,{modelValue:n.expires_at,"onUpdate:modelValue":e[1]||(e[1]=l=>n.expires_at=l),type:"datetime",placeholder:"选择过期时间（可选）",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","disabled-date":R,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),v.value?(m(),$(C,{key:0,label:"状态",prop:"is_active"},{default:a(()=>[t(se,{modelValue:n.is_active,"onUpdate:modelValue":e[2]||(e[2]=l=>n.is_active=l),"active-text":"活跃","inactive-text":"停用"},null,8,["modelValue"])]),_:1})):fe("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(E,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),title:"API 密钥创建成功",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[i("div",Me,[t(p,{type:"primary",onClick:e[5]||(e[5]=l=>k.value=!1)},{default:a(()=>e[16]||(e[16]=[d(" 我已保存 ")])),_:1,__:[16]})])]),default:a(()=>[i("div",De,[t(ie,{title:"重要提示",type:"warning",closable:!1,"show-icon":""},{default:a(()=>e[13]||(e[13]=[d(" 请保存您的 API 密钥，它只会显示一次。如果丢失，您需要删除并重新创建。 ")])),_:1}),i("div",Ce,[e[15]||(e[15]=i("label",null,"您的 API 密钥：",-1)),i("div",Ye,[t(B,{"model-value":V.value,readonly:"",type:"textarea",rows:3},null,8,["model-value"]),t(p,{type:"primary",onClick:L},{default:a(()=>[t(y,null,{default:a(()=>[t(de)]),_:1}),e[14]||(e[14]=d(" 复制 "))]),_:1,__:[14]})])])])]),_:1},8,["modelValue"])])}}}),Fe=ve(Be,[["__scopeId","data-v-11893244"]]);export{Fe as default};
