import{a as k}from"./admin-BeQPA_vV.js";import{c as xe,h as Ce}from"./index-DcR-k5ux.js";import{O as m,R as _,S as K}from"./element-plus-CLNn8XtP.js";import{k as Me,r as c,M as Ue,c as ze,d as Be,l as $,q as n,G as t,A as s,a8 as i,E as g,z as P,u as De,m as v}from"./vue-vendor-CBcJ4V7k.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DzVZk42n.js";const Ee={class:"admin-models"},Te={class:"page-header"},Se={class:"header-actions"},$e={class:"search-form"},Pe={key:0,class:"loading"},Re={class:"model-info"},Ae={class:"model-icon"},Ie={class:"model-details"},Le={class:"model-name"},qe={class:"model-version"},Oe={class:"endpoint-url"},Ye={class:"health-status"},Ne={class:"health-text"},He={class:"table-actions"},Ge={class:"config-row"},Qe={class:"config-row"},je={class:"config-row"},Je={class:"config-row"},Ke={class:"dialog-footer"},We={class:"test-result"},Xe={key:0,class:"test-success"},Ze={class:"result-content"},et={class:"response-content"},tt={class:"response-text"},lt={key:1,class:"test-error"},ot={class:"result-content"},at={class:"error-message"},st=Me({__name:"Models",setup(nt){const C=c(!1),R=c(!1),y=c(!1),M=c(!1),V=c(!1),U=c(""),z=c(""),B=c(""),A=c(null),Y=c([]),D=c(null),b=c({}),F=c(),o=Ue({name:"",provider:"",endpoint_url:"",version:"",description:"",max_tokens:4096,default_temperature:.7,supports_streaming:!0,supports_functions:!1,is_active:!0}),W={name:[{required:!0,message:"请输入模型名称",trigger:"blur"},{min:2,max:100,message:"模型名称长度在 2 到 100 个字符",trigger:"blur"}],provider:[{required:!0,message:"请选择提供商",trigger:"change"}],endpoint_url:[{required:!0,message:"请输入接口地址",trigger:"blur"},{validator:(a,e,r)=>{e&&!Ce(e)?r(new Error("请输入正确的URL地址")):r()},trigger:"blur"}]},X=ze(()=>{let a=Y.value;if(U.value){const e=U.value.toLowerCase();a=a.filter(r=>r.name.toLowerCase().includes(e)||r.provider.toLowerCase().includes(e))}if(z.value&&(a=a.filter(e=>e.provider===z.value)),B.value){const e=B.value==="active";a=a.filter(r=>r.is_active===e)}return a}),Z=a=>{const e={openai:"#10b981",deepseek:"#6366f1",claude:"#f59e0b",local:"#8b5cf6",other:"#6b7280"};return e[a]||e.other},ee=a=>{const e={openai:"success",deepseek:"primary",claude:"warning",local:"info",other:"info"};return e[a]||e.other},te=a=>({openai:"OpenAI",deepseek:"Deepseek",claude:"Claude",local:"本地模型",other:"其他"})[a]||a,le=a=>{const e={healthy:"#67c23a",unhealthy:"#f56c6c",unknown:"#909399"};return e[a]||e.unknown},oe=a=>({healthy:"健康",unhealthy:"异常",unknown:"未知"})[a]||"未知",w=async()=>{try{C.value=!0,Y.value=await k.getModels()}catch(a){m.error("获取模型列表失败"),console.error("Failed to load models:",a)}finally{C.value=!1}},ae=async()=>{await w(),m.success("模型列表已刷新")},se=()=>{},N=()=>{},ne=a=>{const e={openai:"https://api.openai.com/v1/chat/completions",deepseek:"https://api.deepseek.com/v1/chat/completions",claude:"https://api.anthropic.com/v1/messages",local:"http://localhost:8000/v1/chat/completions"};e[a]&&(o.endpoint_url=e[a])},ie=()=>{V.value=!1,y.value=!0},re=a=>{var e,r,d,p,E,T;V.value=!0,D.value=a,o.name=a.name,o.provider=a.provider,o.endpoint_url=a.endpoint_url,o.version=((e=a.metadata)==null?void 0:e.version)||"",o.description=((r=a.metadata)==null?void 0:r.description)||"",o.max_tokens=((d=a.metadata)==null?void 0:d.max_tokens)||4096,o.default_temperature=((p=a.metadata)==null?void 0:p.default_temperature)||.7,o.supports_streaming=((E=a.metadata)==null?void 0:E.supports_streaming)??!0,o.supports_functions=((T=a.metadata)==null?void 0:T.supports_functions)??!1,o.is_active=a.is_active,y.value=!0},de=()=>{var a;o.name="",o.provider="",o.endpoint_url="",o.version="",o.description="",o.max_tokens=4096,o.default_temperature=.7,o.supports_streaming=!0,o.supports_functions=!1,o.is_active=!0,D.value=null,(a=F.value)==null||a.resetFields()},ue=async()=>{F.value&&await F.value.validate(async a=>{if(a)try{R.value=!0;const e={version:o.version,description:o.description,max_tokens:o.max_tokens,default_temperature:o.default_temperature,supports_streaming:o.supports_streaming,supports_functions:o.supports_functions};if(V.value&&D.value){const r={name:o.name,provider:o.provider,endpoint_url:o.endpoint_url,metadata:e,is_active:o.is_active};await k.updateModel(D.value.id,r),m.success("模型信息已更新")}else await k.createModel({name:o.name,provider:o.provider,endpoint_url:o.endpoint_url,metadata:e,is_active:o.is_active}),m.success("模型添加成功");y.value=!1,await w()}catch(e){m.error(e.message||"操作失败")}finally{R.value=!1}})},ce=async a=>{try{A.value=a.id;const e=await k.testModel(a.id);b.value=e,M.value=!0}catch(e){b.value={success:!1,error:e.message||"测试失败"},M.value=!0}finally{A.value=null}},pe=async a=>{try{await K.confirm(`确定要${a.is_active?"停用":"启用"}模型 "${a.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.updateModel(a.id,{is_active:!a.is_active}),m.success(`模型已${a.is_active?"停用":"启用"}`),await w()}catch(e){e!=="cancel"&&m.error("操作失败")}},_e=async a=>{try{await K.confirm(`确定要删除模型 "${a.name}" 吗？此操作不可恢复。`,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}),await k.deleteModel(a.id),m.success("模型已删除"),await w()}catch(e){e!=="cancel"&&m.error("删除失败")}};return Be(async()=>{await w()}),(a,e)=>{const r=i("Refresh"),d=i("el-icon"),p=i("el-button"),E=i("Plus"),T=i("Search"),x=i("el-input"),u=i("el-option"),I=i("el-select"),L=i("el-card"),me=i("el-skeleton"),ve=i("Box"),f=i("el-table-column"),H=i("el-tag"),G=i("CircleCheckFilled"),Q=i("CircleCloseFilled"),fe=i("Loading"),he=i("Position"),S=i("el-tooltip"),ge=i("Edit"),ye=i("Switch"),be=i("Delete"),ke=i("el-empty"),Ve=i("el-table"),h=i("el-form-item"),j=i("el-input-number"),q=i("el-switch"),we=i("el-form"),J=i("el-dialog");return v(),$("div",Ee,[n("div",Te,[e[18]||(e[18]=n("div",{class:"header-content"},[n("h1",null,"模型管理"),n("p",null,"管理系统接入的大模型，配置模型参数和状态")],-1)),n("div",Se,[t(p,{onClick:ae,loading:C.value},{default:s(()=>[t(d,null,{default:s(()=>[t(r)]),_:1}),e[16]||(e[16]=g(" 刷新 "))]),_:1,__:[16]},8,["loading"]),t(p,{type:"primary",onClick:ie},{default:s(()=>[t(d,null,{default:s(()=>[t(E)]),_:1}),e[17]||(e[17]=g(" 添加模型 "))]),_:1,__:[17]})])]),t(L,{shadow:"never",class:"search-card"},{default:s(()=>[n("div",$e,[t(x,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=l=>U.value=l),placeholder:"搜索模型名称或提供商",clearable:"",style:{width:"300px"},onInput:se},{prefix:s(()=>[t(d,null,{default:s(()=>[t(T)]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=l=>z.value=l),placeholder:"提供商",clearable:"",style:{width:"150px"},onChange:N},{default:s(()=>[t(u,{label:"全部",value:""}),t(u,{label:"OpenAI",value:"openai"}),t(u,{label:"Deepseek",value:"deepseek"}),t(u,{label:"Claude",value:"claude"}),t(u,{label:"本地模型",value:"local"})]),_:1},8,["modelValue"]),t(I,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=l=>B.value=l),placeholder:"模型状态",clearable:"",style:{width:"150px"},onChange:N},{default:s(()=>[t(u,{label:"全部",value:""}),t(u,{label:"活跃",value:"active"}),t(u,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])])]),_:1}),t(L,{shadow:"never"},{default:s(()=>[C.value?(v(),$("div",Pe,[t(me,{rows:8,animated:""})])):(v(),P(Ve,{key:1,data:X.value,style:{width:"100%"},"row-key":"id"},{empty:s(()=>[t(ke,{description:"暂无模型数据"})]),default:s(()=>[t(f,{prop:"name",label:"模型名称","min-width":"180"},{default:s(({row:l})=>[n("div",Re,[n("div",Ae,[t(d,{size:"20",color:Z(l.provider)},{default:s(()=>[t(ve)]),_:2},1032,["color"])]),n("div",Ie,[n("div",Le,_(l.name),1),n("div",qe,_(l.version||"v1.0"),1)])])]),_:1}),t(f,{prop:"provider",label:"提供商",width:"120"},{default:s(({row:l})=>[t(H,{type:ee(l.provider),size:"small"},{default:s(()=>[g(_(te(l.provider)),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"endpoint_url",label:"接口地址","min-width":"250","show-overflow-tooltip":""},{default:s(({row:l})=>[n("code",Oe,_(l.endpoint_url),1)]),_:1}),t(f,{prop:"is_active",label:"状态",width:"80"},{default:s(({row:l})=>[t(H,{type:l.is_active?"success":"danger",size:"small"},{default:s(()=>[g(_(l.is_active?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"health_status",label:"健康状态",width:"100"},{default:s(({row:l})=>[n("div",Ye,[t(d,{color:le(l.health_status),size:"16"},{default:s(()=>[l.health_status==="healthy"?(v(),P(G,{key:0})):l.health_status==="unhealthy"?(v(),P(Q,{key:1})):(v(),P(fe,{key:2}))]),_:2},1032,["color"]),n("span",Ne,_(oe(l.health_status)),1)])]),_:1}),t(f,{prop:"created_at",label:"创建时间",width:"160"},{default:s(({row:l})=>[g(_(De(xe)(l.created_at,"YYYY-MM-DD")),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:s(({row:l})=>[n("div",He,[t(S,{content:"测试"},{default:s(()=>[t(p,{size:"small",text:"",type:"primary",onClick:O=>ce(l),loading:A.value===l.id},{default:s(()=>[t(d,null,{default:s(()=>[t(he)]),_:1})]),_:2},1032,["onClick","loading"])]),_:2},1024),t(S,{content:"编辑"},{default:s(()=>[t(p,{size:"small",text:"",onClick:O=>re(l)},{default:s(()=>[t(d,null,{default:s(()=>[t(ge)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(S,{content:l.is_active?"停用":"启用"},{default:s(()=>[t(p,{size:"small",text:"",type:l.is_active?"warning":"success",onClick:O=>pe(l)},{default:s(()=>[t(d,null,{default:s(()=>[t(ye)]),_:1})]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),t(S,{content:"删除"},{default:s(()=>[t(p,{size:"small",text:"",type:"danger",onClick:O=>_e(l)},{default:s(()=>[t(d,null,{default:s(()=>[t(be)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"]))]),_:1}),t(J,{modelValue:y.value,"onUpdate:modelValue":e[14]||(e[14]=l=>y.value=l),title:V.value?"编辑模型":"添加模型",width:"600px",onClose:de},{footer:s(()=>[n("div",Ke,[t(p,{onClick:e[13]||(e[13]=l=>y.value=!1)},{default:s(()=>e[23]||(e[23]=[g("取消")])),_:1,__:[23]}),t(p,{type:"primary",loading:R.value,onClick:ue},{default:s(()=>[g(_(V.value?"保存":"添加"),1)]),_:1},8,["loading"])])]),default:s(()=>[t(we,{ref_key:"formRef",ref:F,model:o,rules:W,"label-width":"100px"},{default:s(()=>[t(h,{label:"模型名称",prop:"name"},{default:s(()=>[t(x,{modelValue:o.name,"onUpdate:modelValue":e[3]||(e[3]=l=>o.name=l),placeholder:"例如: gpt-4o, deepseek-coder-v2",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(h,{label:"提供商",prop:"provider"},{default:s(()=>[t(I,{modelValue:o.provider,"onUpdate:modelValue":e[4]||(e[4]=l=>o.provider=l),placeholder:"选择模型提供商",style:{width:"100%"},onChange:ne},{default:s(()=>[t(u,{label:"OpenAI",value:"openai"}),t(u,{label:"Deepseek",value:"deepseek"}),t(u,{label:"Claude",value:"claude"}),t(u,{label:"本地模型",value:"local"}),t(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"接口地址",prop:"endpoint_url"},{default:s(()=>[t(x,{modelValue:o.endpoint_url,"onUpdate:modelValue":e[5]||(e[5]=l=>o.endpoint_url=l),placeholder:"https://api.openai.com/v1/chat/completions",type:"url"},null,8,["modelValue"])]),_:1}),t(h,{label:"版本",prop:"version"},{default:s(()=>[t(x,{modelValue:o.version,"onUpdate:modelValue":e[6]||(e[6]=l=>o.version=l),placeholder:"模型版本（可选）",maxlength:"50"},null,8,["modelValue"])]),_:1}),t(h,{label:"描述",prop:"description"},{default:s(()=>[t(x,{modelValue:o.description,"onUpdate:modelValue":e[7]||(e[7]=l=>o.description=l),type:"textarea",rows:3,placeholder:"模型描述信息",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(h,{label:"模型配置"},{default:s(()=>[t(L,{shadow:"never",class:"config-card"},{default:s(()=>[n("div",Ge,[e[19]||(e[19]=n("label",null,"最大Token数：",-1)),t(j,{modelValue:o.max_tokens,"onUpdate:modelValue":e[8]||(e[8]=l=>o.max_tokens=l),min:1,max:1e5,placeholder:"4096",style:{width:"120px"}},null,8,["modelValue"])]),n("div",Qe,[e[20]||(e[20]=n("label",null,"默认Temperature：",-1)),t(j,{modelValue:o.default_temperature,"onUpdate:modelValue":e[9]||(e[9]=l=>o.default_temperature=l),min:0,max:2,step:.1,placeholder:"0.7",style:{width:"120px"}},null,8,["modelValue"])]),n("div",je,[e[21]||(e[21]=n("label",null,"支持流式：",-1)),t(q,{modelValue:o.supports_streaming,"onUpdate:modelValue":e[10]||(e[10]=l=>o.supports_streaming=l)},null,8,["modelValue"])]),n("div",Je,[e[22]||(e[22]=n("label",null,"支持函数调用：",-1)),t(q,{modelValue:o.supports_functions,"onUpdate:modelValue":e[11]||(e[11]=l=>o.supports_functions=l)},null,8,["modelValue"])])]),_:1})]),_:1}),t(h,{label:"状态",prop:"is_active"},{default:s(()=>[t(q,{modelValue:o.is_active,"onUpdate:modelValue":e[12]||(e[12]=l=>o.is_active=l),"active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(J,{modelValue:M.value,"onUpdate:modelValue":e[15]||(e[15]=l=>M.value=l),title:"模型测试结果",width:"500px"},{default:s(()=>[n("div",We,[b.value.success?(v(),$("div",Xe,[t(d,{color:"#67c23a",size:"24"},{default:s(()=>[t(G)]),_:1}),n("div",Ze,[e[25]||(e[25]=n("h4",null,"测试成功",-1)),n("p",null,"模型响应正常，延迟: "+_(b.value.latency)+"ms",1),n("div",et,[e[24]||(e[24]=n("strong",null,"响应内容:",-1)),n("div",tt,_(b.value.response),1)])])])):(v(),$("div",lt,[t(d,{color:"#f56c6c",size:"24"},{default:s(()=>[t(Q)]),_:1}),n("div",ot,[e[26]||(e[26]=n("h4",null,"测试失败",-1)),n("p",at,_(b.value.error),1)])]))])]),_:1},8,["modelValue"])])}}}),mt=Fe(st,[["__scopeId","data-v-6bac7ec5"]]);export{mt as default};
