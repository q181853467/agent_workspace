import{k as W,r as y,c as Y,e as X,d as Z,l as m,q as s,G as o,A as a,a8 as c,C as $,F as b,Y as z,W as L,K as H,u as D,E as f,n as ee,m as r,z as I}from"./vue-vendor-CBcJ4V7k.js";import{u as se}from"./models-BBVZaHDl.js";import{M as te,c as oe,H as N}from"./index-nzQNOEPp.js";import{g as ae,a as ne,d as le}from"./index-DcR-k5ux.js";import{O as M,R as p,o as ie,S as ce}from"./element-plus-CLNn8XtP.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DzVZk42n.js";const de={class:"chat-container"},ue={class:"chat-header"},me={class:"model-selector"},_e={class:"model-option"},pe={class:"chat-content"},ve={key:0,class:"welcome-message"},he={class:"welcome-icon"},fe={class:"example-questions"},ge={class:"question-chips"},ye={class:"message-avatar"},Me={class:"message-content"},Ce={class:"message-header"},we={class:"message-role"},ke={class:"message-time"},xe={class:"message-text"},be=["innerHTML"],ze={key:1,class:"user-message"},De={key:1,class:"message assistant"},Ie={class:"message-avatar"},Ve={class:"chat-input"},Ae={class:"input-container"},Se={class:"input-actions"},Te={class:"chat-controls"},Be=W({__name:"Chat",setup(Re){const l=se(),d=y([]),v=y(""),_=y(!1),g=y(),V=Y({get:()=>{var n;return((n=l.selectedModel)==null?void 0:n.name)||""},set:n=>{const e=l.activeModels.find(i=>i.name===n);e&&l.selectModel(e)}}),E=["你好，请介绍一下自己","写一个 Python 快速排序算法","解释一下机器学习的基本概念","当前时间是多少？"],K=new te({highlight:function(n,e){if(e&&N.getLanguage(e))try{return N.highlight(n,{language:e}).value}catch{}return""}}),P=n=>K.render(n),U=n=>{const e=l.activeModels.find(i=>i.name===n);e&&(l.selectModel(e),M.success(`已切换到模型：${e.display_name}`))},A=async n=>{const e=n||v.value.trim();if(!e||_.value)return;if(!l.selectedModel){M.error("请先选择一个模型");return}const i={role:"user",content:e,timestamp:new Date};d.value.push(i),n||(v.value=""),_.value=!0;try{const h=d.value.map(u=>({role:u.role,content:u.content})),C={role:"assistant",content:(await oe.createChatCompletion({model:l.selectedModel.name,messages:h,temperature:.7,max_tokens:1024})).choices[0].message.content,timestamp:new Date};d.value.push(C)}catch(h){M.error(h.message||"请求失败"),console.error("Chat error:",h)}finally{_.value=!1,T()}},S=()=>{A()},q=async()=>{try{await ce.confirm("确定要清空所有对话记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=[]}catch{}},F=()=>{const n=d.value.map(i=>`**${i.role==="user"?"用户":"AI助手"}** (${i.timestamp.toLocaleString()})

${i.content}

---

`).join(""),e=`chat_export_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.md`;le(n,e,"text/markdown"),M.success("对话已导出")},T=()=>{ee(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})};return X(()=>d.value.length,()=>{T()}),Z(async()=>{await l.fetchActiveModels(),!l.selectedModel&&l.activeModels.length>0&&l.selectModel(l.activeModels[0])}),(n,e)=>{const i=c("el-tag"),h=c("el-option"),B=c("el-select"),C=c("ChatDotRound"),u=c("el-icon"),O=c("User"),w=c("el-avatar"),R=c("Robot"),j=c("el-input"),G=c("Promotion"),k=c("el-button"),J=c("Delete"),Q=c("Download");return r(),m("div",de,[s("div",ue,[e[3]||(e[3]=s("div",{class:"chat-title"},[s("h1",null,"AI 对话"),s("p",null,"与 AI 模型进行智能对话")],-1)),s("div",me,[o(B,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),placeholder:"选择模型",onChange:U},{default:a(()=>[(r(!0),m(b,null,z(D(l).activeModels,t=>(r(),I(h,{key:t.id,label:t.display_name,value:t.name},{default:a(()=>[s("div",_e,[s("span",null,p(D(ae)(t.provider))+" "+p(t.display_name),1),o(i,{size:"small",type:"info"},{default:a(()=>[f(p(t.provider),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),s("div",pe,[s("div",{class:"messages-container",ref_key:"messagesContainer",ref:g},[d.value.length===0?(r(),m("div",ve,[s("div",he,[o(u,{size:"48",color:"var(--primary-color)"},{default:a(()=>[o(C)]),_:1})]),e[5]||(e[5]=s("h3",null,"开始与 AI 对话",-1)),e[6]||(e[6]=s("p",null,"输入您的问题，AI 将为您提供智能回答",-1)),s("div",fe,[e[4]||(e[4]=s("h4",null,"试试这些问题：",-1)),s("div",ge,[(r(),m(b,null,z(E,(t,x)=>o(i,{key:x,class:"question-chip",onClick:$e=>A(t)},{default:a(()=>[f(p(t),1)]),_:2},1032,["onClick"])),64))])])])):$("",!0),(r(!0),m(b,null,z(d.value,(t,x)=>(r(),m("div",{key:x,class:ie(["message",t.role])},[s("div",ye,[t.role==="user"?(r(),I(w,{key:0,size:32},{default:a(()=>[o(u,null,{default:a(()=>[o(O)]),_:1})]),_:1})):(r(),I(w,{key:1,size:32,class:"assistant-avatar"},{default:a(()=>[o(u,null,{default:a(()=>[o(R)]),_:1})]),_:1}))]),s("div",Me,[s("div",Ce,[s("span",we,p(t.role==="user"?"您":"AI 助手"),1),s("span",ke,p(D(ne)(t.timestamp)),1)]),s("div",xe,[t.role==="assistant"?(r(),m("div",{key:0,class:"assistant-message",innerHTML:P(t.content)},null,8,be)):(r(),m("div",ze,p(t.content),1))])])],2))),128)),_.value?(r(),m("div",De,[s("div",Ie,[o(w,{size:32,class:"assistant-avatar"},{default:a(()=>[o(u,null,{default:a(()=>[o(R)]),_:1})]),_:1})]),e[7]||(e[7]=s("div",{class:"message-content"},[s("div",{class:"loading-dots"},[s("span"),s("span"),s("span")])],-1))])):$("",!0)],512),s("div",Ve,[s("div",Ae,[o(j,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),type:"textarea",rows:1,autosize:{minRows:1,maxRows:4},placeholder:"输入您的问题...",disabled:_.value,onKeydown:[L(H(S,["exact","prevent"]),["enter"]),e[2]||(e[2]=L(H(t=>v.value+=`
`,["shift","exact"]),["enter"]))]},null,8,["modelValue","disabled","onKeydown"]),s("div",Se,[o(k,{type:"primary",disabled:!v.value.trim()||_.value,onClick:S},{default:a(()=>[o(u,null,{default:a(()=>[o(G)]),_:1}),e[8]||(e[8]=f(" 发送 "))]),_:1,__:[8]},8,["disabled"])])]),s("div",Te,[o(k,{size:"small",onClick:q,disabled:d.value.length===0||_.value},{default:a(()=>[o(u,null,{default:a(()=>[o(J)]),_:1}),e[9]||(e[9]=f(" 清空对话 "))]),_:1,__:[9]},8,["disabled"]),o(k,{size:"small",onClick:F,disabled:d.value.length===0},{default:a(()=>[o(u,null,{default:a(()=>[o(Q)]),_:1}),e[10]||(e[10]=f(" 导出对话 "))]),_:1,__:[10]},8,["disabled"])])])])])}}}),qe=re(Be,[["__scopeId","data-v-78357fde"]]);export{qe as default};
