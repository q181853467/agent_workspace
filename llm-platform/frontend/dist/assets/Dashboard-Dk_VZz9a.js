import{k as G,r as m,d as H,l as f,q as s,G as e,A as a,a8 as i,u as h,z as I,E as r,C as W,ak as j,m as _}from"./vue-vendor-CBcJ4V7k.js";import{a as z}from"./admin-BeQPA_vV.js";import{f as J,a as K,t as Q}from"./index-DcR-k5ux.js";import{u as X,i as Y,a as Z,b as ss,c as ts,d as es,e as as,f as os,H as ls}from"./charts-BvHsk1LS.js";import{R as d,o as ns,O as is}from"./element-plus-CLNn8XtP.js";import{_ as ds}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DzVZk42n.js";const rs={class:"admin-dashboard"},cs={class:"stats-grid"},_s={class:"stat-content"},us={class:"stat-icon primary"},ms={class:"stat-info"},vs={class:"stat-value"},ps={class:"stat-change positive"},fs={class:"stat-content"},hs={class:"stat-icon success"},gs={class:"stat-info"},ys={class:"stat-value"},bs={class:"stat-change positive"},ws={class:"stat-content"},xs={class:"stat-icon warning"},ks={class:"stat-info"},zs={class:"stat-value"},Cs={class:"stat-content"},Ss={class:"stat-icon info"},Rs={class:"stat-info"},As={class:"stat-value"},Ps={class:"charts-grid"},Is={class:"chart-header"},Ls={class:"chart-container"},Ts={key:1,class:"chart-loading"},qs={class:"chart-header"},Ds={class:"status-list"},Vs={class:"status-item"},$s={class:"status-item"},Bs={class:"status-item"},Ns={class:"status-item"},Us={class:"chart-header"},Ms={key:0,class:"logs-loading"},Os={key:0,class:"error-message"},Es={key:1,class:"text-success"},Fs={key:2,class:"empty-logs"},Gs=G({__name:"Dashboard",setup(Hs){X([Y,Z,ss,ts,es,as,os]);const L=j(),C=m(!1),y=m(!1),g=m(!1),b=m("7"),c=m({total_users:0,active_users:0,total_models:0,active_models:0,recent_api_calls_24h:0,avg_latency_ms:0}),w=m(null),x=m([]),T=o=>o<100?"positive":o<500?"neutral":"negative",q=o=>({chat:"primary",chat_stream:"success",completions:"info",embeddings:"warning"})[o]||"info",D=async()=>{try{const o=await z.getOverviewStats();c.value=o}catch(o){console.error("Failed to load overview stats:",o)}},S=async()=>{try{const o=await z.getUsageStats(parseInt(b.value)),t=o.daily_stats.map(n=>n.date),k=o.daily_stats.map(n=>n.request_count),u=o.daily_stats.map(n=>Math.round(n.avg_latency_ms));w.value={title:{text:"API使用趋势",left:"center",textStyle:{fontSize:16,fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["请求数","平均延迟(ms)"],bottom:0},xAxis:{type:"category",data:t,axisLabel:{formatter:n=>new Date(n).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}},yAxis:[{type:"value",name:"请求数",position:"left"},{type:"value",name:"延迟(ms)",position:"right"}],series:[{name:"请求数",type:"bar",data:k,itemStyle:{color:"#6366f1"}},{name:"平均延迟(ms)",type:"line",yAxisIndex:1,data:u,itemStyle:{color:"#06b6d4"}}]}}catch(o){console.error("Failed to load usage stats:",o)}},V=async()=>{try{g.value=!0;const o=await z.getRecentLogs(20);x.value=o}catch(o){console.error("Failed to load recent logs:",o)}finally{g.value=!1}},$=async()=>{y.value=!0,await new Promise(o=>setTimeout(o,1e3)),y.value=!1,is.success("系统状态已刷新")};return H(async()=>{C.value=!0,await Promise.all([D(),S(),V()]),C.value=!1}),(o,t)=>{const k=i("User"),u=i("el-icon"),n=i("el-card"),B=i("Box"),N=i("ChatDotRound"),U=i("Timer"),R=i("el-option"),M=i("el-select"),A=i("el-skeleton"),O=i("Refresh"),P=i("el-button"),v=i("el-tag"),p=i("el-table-column"),E=i("el-table"),F=i("el-empty");return _(),f("div",rs,[t[20]||(t[20]=s("div",{class:"dashboard-header"},[s("h1",null,"管理概览"),s("p",null,"平台运营数据和系统状态监控")],-1)),s("div",cs,[e(n,{class:"stat-card",shadow:"hover"},{default:a(()=>[s("div",_s,[s("div",us,[e(u,{size:"24"},{default:a(()=>[e(k)]),_:1})]),s("div",ms,[s("div",vs,d(c.value.total_users||0),1),t[2]||(t[2]=s("div",{class:"stat-label"},"总用户数",-1)),s("div",ps,"活跃: "+d(c.value.active_users||0),1)])])]),_:1}),e(n,{class:"stat-card",shadow:"hover"},{default:a(()=>[s("div",fs,[s("div",hs,[e(u,{size:"24"},{default:a(()=>[e(B)]),_:1})]),s("div",gs,[s("div",ys,d(c.value.total_models||0),1),t[3]||(t[3]=s("div",{class:"stat-label"},"模型总数",-1)),s("div",bs,"活跃: "+d(c.value.active_models||0),1)])])]),_:1}),e(n,{class:"stat-card",shadow:"hover"},{default:a(()=>[s("div",ws,[s("div",xs,[e(u,{size:"24"},{default:a(()=>[e(N)]),_:1})]),s("div",ks,[s("div",zs,d(h(J)(c.value.recent_api_calls_24h||0)),1),t[4]||(t[4]=s("div",{class:"stat-label"},"24小时请求",-1)),t[5]||(t[5]=s("div",{class:"stat-change neutral"},"API调用",-1))])])]),_:1}),e(n,{class:"stat-card",shadow:"hover"},{default:a(()=>[s("div",Cs,[s("div",Ss,[e(u,{size:"24"},{default:a(()=>[e(U)]),_:1})]),s("div",Rs,[s("div",As,d(Math.round(c.value.avg_latency_ms||0))+"ms",1),t[6]||(t[6]=s("div",{class:"stat-label"},"平均延迟",-1)),s("div",{class:ns(["stat-change",T(c.value.avg_latency_ms)])},"响应时间",2)])])]),_:1})]),s("div",Ps,[e(n,{class:"chart-card",shadow:"never"},{header:a(()=>[s("div",Is,[t[7]||(t[7]=s("span",null,"API使用趋势",-1)),e(M,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=l=>b.value=l),size:"small",style:{width:"100px"},onChange:S},{default:a(()=>[e(R,{label:"7天",value:"7"}),e(R,{label:"30天",value:"30"})]),_:1},8,["modelValue"])])]),default:a(()=>[s("div",Ls,[w.value?(_(),I(h(ls),{key:0,option:w.value,class:"chart",autoresize:""},null,8,["option"])):(_(),f("div",Ts,[e(A,{rows:6,animated:""})]))])]),_:1}),e(n,{class:"status-card",shadow:"never"},{header:a(()=>[s("div",qs,[t[9]||(t[9]=s("span",null,"系统状态",-1)),e(P,{size:"small",onClick:$,loading:y.value},{default:a(()=>[e(u,null,{default:a(()=>[e(O)]),_:1}),t[8]||(t[8]=r(" 刷新 "))]),_:1,__:[8]},8,["loading"])])]),default:a(()=>[s("div",Ds,[s("div",Vs,[t[11]||(t[11]=s("div",{class:"status-info"},[s("span",{class:"status-name"},"API服务"),s("span",{class:"status-desc"},"核心API服务状态")],-1)),e(v,{type:"success",size:"small"},{default:a(()=>t[10]||(t[10]=[r("正常")])),_:1,__:[10]})]),s("div",$s,[t[13]||(t[13]=s("div",{class:"status-info"},[s("span",{class:"status-name"},"数据库"),s("span",{class:"status-desc"},"数据库连接状态")],-1)),e(v,{type:"success",size:"small"},{default:a(()=>t[12]||(t[12]=[r("正常")])),_:1,__:[12]})]),s("div",Bs,[t[15]||(t[15]=s("div",{class:"status-info"},[s("span",{class:"status-name"},"模型服务"),s("span",{class:"status-desc"},"模型调用服务状态")],-1)),e(v,{type:"success",size:"small"},{default:a(()=>t[14]||(t[14]=[r("正常")])),_:1,__:[14]})]),s("div",Ns,[t[17]||(t[17]=s("div",{class:"status-info"},[s("span",{class:"status-name"},"缓存服务"),s("span",{class:"status-desc"},"Redis缓存状态")],-1)),e(v,{type:"warning",size:"small"},{default:a(()=>t[16]||(t[16]=[r("可选")])),_:1,__:[16]})])])]),_:1})]),e(n,{shadow:"never"},{header:a(()=>[s("div",Us,[t[19]||(t[19]=s("span",null,"最近日志",-1)),e(P,{size:"small",onClick:t[1]||(t[1]=l=>h(L).push("/admin/logs"))},{default:a(()=>t[18]||(t[18]=[r(" 查看全部 ")])),_:1,__:[18]})])]),default:a(()=>[g.value?(_(),f("div",Ms,[e(A,{rows:5,animated:""})])):(_(),I(E,{key:1,data:x.value.slice(0,10),style:{width:"100%"}},{default:a(()=>[e(p,{prop:"request_type",label:"类型",width:"100"},{default:a(({row:l})=>[e(v,{size:"small",type:q(l.request_type)},{default:a(()=>[r(d(l.request_type),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status_code",label:"状态",width:"80"},{default:a(({row:l})=>[e(v,{size:"small",type:l.status_code===200?"success":"danger"},{default:a(()=>[r(d(l.status_code),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"latency_ms",label:"延迟",width:"80"},{default:a(({row:l})=>[r(d(l.latency_ms)+"ms ",1)]),_:1}),e(p,{prop:"total_tokens",label:"Tokens",width:"80"},{default:a(({row:l})=>[r(d(l.total_tokens||"-"),1)]),_:1}),e(p,{prop:"created_at",label:"时间",width:"160"},{default:a(({row:l})=>[r(d(h(K)(l.created_at)),1)]),_:1}),e(p,{prop:"error_message",label:"错误信息","min-width":"200"},{default:a(({row:l})=>[l.error_message?(_(),f("span",Os,d(h(Q)(l.error_message,50)),1)):(_(),f("span",Es,"正常"))]),_:1})]),_:1},8,["data"])),!g.value&&x.value.length===0?(_(),f("div",Fs,[e(F,{description:"暂无日志数据"})])):W("",!0)]),_:1})])}}}),Zs=ds(Gs,[["__scopeId","data-v-92185129"]]);export{Zs as default};
