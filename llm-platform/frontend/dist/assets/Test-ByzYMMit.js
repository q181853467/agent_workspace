import{u as ee}from"./models-BBVZaHDl.js";import{M as se,H as R,c as te}from"./index-nzQNOEPp.js";import{g as oe,c as D,t as ae,a as le,d as ne}from"./index-DcR-k5ux.js";import{R as i,O as w}from"./element-plus-CLNn8XtP.js";import{k as re,r as q,M as ue,d as ie,l as h,q as s,G as o,z as V,C,A as a,a8 as u,F as H,Y as P,u as T,E as d,m as c}from"./vue-vendor-CBcJ4V7k.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DzVZk42n.js";const me={class:"test-page"},ce={class:"test-content"},pe={class:"model-option"},_e={class:"card-header"},ve={class:"header-actions"},fe={class:"test-input"},ge={class:"input-actions"},he={class:"card-header"},ke={class:"test-status"},ye={class:"duration"},xe={class:"test-results"},we={class:"result-section"},Te={class:"result-section"},be={key:0,class:"response-content"},qe=["innerHTML"],Me={key:0,class:"usage-info"},Ve={class:"usage-stats"},Ce={class:"usage-item"},$e={class:"value"},Ie={class:"usage-item"},Re={class:"value"},De={class:"usage-item"},He={class:"value"},Pe={key:1,class:"error-content"},ze={class:"card-header"},Ae={class:"history-list"},Le=["onClick"],Se={class:"history-info"},Ee={class:"history-header"},Ue={class:"model"},Be={class:"history-prompt"},Ne={class:"history-meta"},Fe=re({__name:"Test",setup(Oe){const k=ee(),M=q(!1),r=q(null),v=q([]),p=q(""),l=ue({model:"",temperature:.7,max_tokens:1024,stream:!1}),z=new se({highlight:function(t,e){if(e&&R.getLanguage(e))try{return R.highlight(t,{language:e}).value}catch{}return""}}),A=t=>z.render(t),L=()=>{const t=["请编写一个 Python 函数，计算斐波那契数列的第n项。","解释一下机器学习中的梯度下降算法。","你好！请介绍一下你的能力和特点。","请写一个关于React Hooks的简单教程。","分析一下人工智能在未来十年的发展趋势。"],e=t[Math.floor(Math.random()*t.length)];p.value=e},S=()=>{p.value=""},E=async()=>{if(!p.value.trim()||!l.model){w.error("请输入测试内容并选择模型");return}M.value=!0;const t=Date.now(),e={model:l.model,prompt:p.value,temperature:l.temperature,max_tokens:l.max_tokens,stream:l.stream};try{const m={model:l.model,messages:[{role:"user",content:p.value}],temperature:l.temperature,max_tokens:l.max_tokens,stream:l.stream},_=await te.createChatCompletion(m),f=Date.now()-t,g={request:e,response:{content:_.choices[0].message.content,usage:_.usage},status:"success",duration:f,timestamp:new Date};r.value=g,v.value.unshift(g),v.value.length>10&&(v.value=v.value.slice(0,10)),w.success(`测试完成，耗时 ${f}ms`)}catch(m){const _=Date.now()-t,f={request:e,status:"error",error:m.message||"请求失败",duration:_,timestamp:new Date};r.value=f,v.value.unshift(f),w.error("测试失败："+(m.message||"未知错误"))}finally{M.value=!1}},U=()=>{var _;if(!r.value)return;const t=r.value,e=`# API 测试结果

## 请求信息
- 模型: ${t.request.model}
- Temperature: ${t.request.temperature}
- Max Tokens: ${t.request.max_tokens}
- 流式: ${t.request.stream?"是":"否"}
- 测试时间: ${D(t.timestamp)}
- 耗时: ${t.duration}ms

## 输入内容
${t.request.prompt}

## 响应结果
${t.status==="success"?t.response.content:`错误: ${t.error}`}

${t.status==="success"&&((_=t.response)!=null&&_.usage)?`## Token 使用
- 输入 Tokens: ${t.response.usage.prompt_tokens}
- 输出 Tokens: ${t.response.usage.completion_tokens}
- 总 Tokens: ${t.response.usage.total_tokens}`:""}
`,m=`api_test_${t.timestamp.toISOString().slice(0,19).replace(/:/g,"-")}.md`;ne(e,m,"text/markdown"),w.success("测试结果已导出")},B=t=>{r.value=t,p.value=t.request.prompt,l.model=t.request.model,l.temperature=t.request.temperature,l.max_tokens=t.request.max_tokens,l.stream=t.request.stream},N=()=>{v.value=[],w.success("测试历史已清空")};return ie(async()=>{var t;await k.fetchActiveModels(),k.activeModels.length>0&&(l.model=((t=k.selectedModel)==null?void 0:t.name)||k.activeModels[0].name)}),(t,e)=>{const m=u("el-tag"),_=u("el-option"),f=u("el-select"),g=u("el-form-item"),F=u("el-slider"),$=u("el-col"),O=u("el-input-number"),G=u("el-row"),J=u("el-switch"),Y=u("el-form"),b=u("el-card"),y=u("el-button"),j=u("el-input"),K=u("CaretRight"),I=u("el-icon"),Q=u("Download"),x=u("el-descriptions-item"),W=u("el-descriptions"),X=u("el-alert");return c(),h("div",me,[e[21]||(e[21]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",null,"API 测试"),s("p",null,"测试 LLM Platform API 的功能和性能")])],-1)),s("div",ce,[o(b,{class:"config-card",shadow:"never"},{header:a(()=>e[5]||(e[5]=[s("div",{class:"card-header"},[s("span",null,"API 配置")],-1)])),default:a(()=>[o(Y,{model:l,"label-width":"80px",class:"config-form"},{default:a(()=>[o(g,{label:"模型"},{default:a(()=>[o(f,{modelValue:l.model,"onUpdate:modelValue":e[0]||(e[0]=n=>l.model=n),placeholder:"选择模型",style:{width:"100%"}},{default:a(()=>[(c(!0),h(H,null,P(T(k).activeModels,n=>(c(),V(_,{key:n.id,label:n.display_name,value:n.name},{default:a(()=>[s("div",pe,[s("span",null,i(T(oe)(n.provider))+" "+i(n.display_name),1),o(m,{size:"small",type:"info"},{default:a(()=>[d(i(n.provider),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(G,{gutter:16},{default:a(()=>[o($,{span:12},{default:a(()=>[o(g,{label:"Temperature"},{default:a(()=>[o(F,{modelValue:l.temperature,"onUpdate:modelValue":e[1]||(e[1]=n=>l.temperature=n),min:0,max:2,step:.1,"show-input":""},null,8,["modelValue"])]),_:1})]),_:1}),o($,{span:12},{default:a(()=>[o(g,{label:"Max Tokens"},{default:a(()=>[o(O,{modelValue:l.max_tokens,"onUpdate:modelValue":e[2]||(e[2]=n=>l.max_tokens=n),min:1,max:4096,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(g,{label:"流式"},{default:a(()=>[o(J,{modelValue:l.stream,"onUpdate:modelValue":e[3]||(e[3]=n=>l.stream=n),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),o(b,{shadow:"never"},{header:a(()=>[s("div",_e,[e[8]||(e[8]=s("span",null,"测试输入",-1)),s("div",ve,[o(y,{size:"small",onClick:L},{default:a(()=>e[6]||(e[6]=[d(" 加载示例 ")])),_:1,__:[6]}),o(y,{size:"small",onClick:S},{default:a(()=>e[7]||(e[7]=[d(" 清空 ")])),_:1,__:[7]})])])]),default:a(()=>[s("div",fe,[o(j,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=n=>p.value=n),type:"textarea",rows:6,placeholder:"输入您要测试的提示词...",maxlength:"2000","show-word-limit":""},null,8,["modelValue"]),s("div",ge,[o(y,{type:"primary",loading:M.value,disabled:!p.value.trim()||!l.model,onClick:E},{default:a(()=>[o(I,null,{default:a(()=>[o(K)]),_:1}),e[9]||(e[9]=d(" 运行测试 "))]),_:1,__:[9]},8,["loading","disabled"]),o(y,{disabled:!r.value,onClick:U},{default:a(()=>[o(I,null,{default:a(()=>[o(Q)]),_:1}),e[10]||(e[10]=d(" 导出结果 "))]),_:1,__:[10]},8,["disabled"])])])]),_:1}),r.value?(c(),V(b,{key:0,shadow:"never"},{header:a(()=>[s("div",he,[e[11]||(e[11]=s("span",null,"测试结果",-1)),s("div",ke,[o(m,{type:r.value.status==="success"?"success":"danger",size:"small"},{default:a(()=>[d(i(r.value.status==="success"?"成功":"失败"),1)]),_:1},8,["type"]),s("span",ye,i(r.value.duration)+"ms",1)])])]),default:a(()=>[s("div",xe,[s("div",we,[e[12]||(e[12]=s("h4",null,"请求信息",-1)),o(W,{column:2,border:""},{default:a(()=>[o(x,{label:"模型"},{default:a(()=>[d(i(r.value.request.model),1)]),_:1}),o(x,{label:"Temperature"},{default:a(()=>[d(i(r.value.request.temperature),1)]),_:1}),o(x,{label:"Max Tokens"},{default:a(()=>[d(i(r.value.request.max_tokens),1)]),_:1}),o(x,{label:"流式"},{default:a(()=>[d(i(r.value.request.stream?"是":"否"),1)]),_:1}),o(x,{label:"请求时间",span:2},{default:a(()=>[d(i(T(D)(r.value.timestamp)),1)]),_:1})]),_:1})]),s("div",Te,[e[17]||(e[17]=s("h4",null,"响应结果",-1)),r.value.status==="success"?(c(),h("div",be,[s("div",{class:"response-text",innerHTML:A(r.value.response.content)},null,8,qe),r.value.response.usage?(c(),h("div",Me,[e[16]||(e[16]=s("h5",null,"Token 使用情况",-1)),s("div",Ve,[s("div",Ce,[e[13]||(e[13]=s("span",{class:"label"},"输入 Tokens:",-1)),s("span",$e,i(r.value.response.usage.prompt_tokens),1)]),s("div",Ie,[e[14]||(e[14]=s("span",{class:"label"},"输出 Tokens:",-1)),s("span",Re,i(r.value.response.usage.completion_tokens),1)]),s("div",De,[e[15]||(e[15]=s("span",{class:"label"},"总 Tokens:",-1)),s("span",He,i(r.value.response.usage.total_tokens),1)])])])):C("",!0)])):(c(),h("div",Pe,[o(X,{type:"error",title:r.value.error,"show-icon":"",closable:!1},null,8,["title"])]))])])]),_:1})):C("",!0),v.value.length>0?(c(),V(b,{key:1,shadow:"never"},{header:a(()=>[s("div",ze,[e[19]||(e[19]=s("span",null,"测试历史",-1)),o(y,{size:"small",onClick:N},{default:a(()=>e[18]||(e[18]=[d(" 清空历史 ")])),_:1,__:[18]})])]),default:a(()=>[s("div",Ae,[(c(!0),h(H,null,P(v.value,(n,Z)=>(c(),h("div",{key:Z,class:"history-item",onClick:Ge=>B(n)},[s("div",Se,[s("div",Ee,[s("span",Ue,i(n.request.model),1),o(m,{type:n.status==="success"?"success":"danger",size:"small"},{default:a(()=>[d(i(n.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),s("div",Be,i(T(ae)(n.request.prompt,100)),1),s("div",Ne,[s("span",null,i(T(le)(n.timestamp)),1),e[20]||(e[20]=s("span",null,"·",-1)),s("span",null,i(n.duration)+"ms",1)])])],8,Le))),128))])]),_:1})):C("",!0)])])}}}),Ze=de(Fe,[["__scopeId","data-v-d638d953"]]);export{Ze as default};
