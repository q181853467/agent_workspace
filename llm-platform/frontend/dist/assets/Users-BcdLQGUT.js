import{u as me}from"./index-DzVZk42n.js";import{a as V}from"./admin-BeQPA_vV.js";import{c as _e,a as pe,i as fe}from"./index-DcR-k5ux.js";import{O as u,R as w,S as L}from"./element-plus-CLNn8XtP.js";import{k as ve,r as d,M as ge,c as we,d as ye,l as N,q as i,G as e,A as a,a8 as n,E as m,z as Y,u as R,C as be,m as $}from"./vue-vendor-CBcJ4V7k.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve={class:"admin-users"},xe={class:"page-header"},Ue={class:"header-actions"},Ce={class:"search-form"},ke={key:0,class:"loading"},Ee={class:"user-info"},Se={class:"user-details"},Be={class:"username"},$e={class:"full-name"},ze={class:"table-actions"},De={class:"dialog-footer"},Fe=ve({__name:"Users",setup(Re){const I=me(),x=d(!1),z=d(!1),y=d(!1),_=d(!1),U=d(""),C=d(""),k=d(""),T=d([]),E=d(null),S=d(),o=ge({username:"",email:"",password:"",full_name:"",role:"user",description:"",is_active:!0}),P={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度在 3 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(s,l,r)=>{l&&!fe(l)?r(new Error("请输入正确的邮箱地址")):r()},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少需要6位字符",trigger:"blur"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}]},G=we(()=>{let s=T.value;if(U.value){const l=U.value.toLowerCase();s=s.filter(r=>r.username.toLowerCase().includes(l)||r.email.toLowerCase().includes(l)||r.full_name&&r.full_name.toLowerCase().includes(l))}if(C.value){const l=C.value==="active";s=s.filter(r=>r.is_active===l)}return k.value&&(s=s.filter(l=>l.role===k.value)),s}),h=async()=>{try{x.value=!0,T.value=await V.getUsers()}catch(s){u.error("获取用户列表失败"),console.error("Failed to load users:",s)}finally{x.value=!1}},O=async()=>{await h(),u.success("用户列表已刷新")},Q=()=>{},q=()=>{},j=()=>{_.value=!1,y.value=!0},H=s=>{_.value=!0,E.value=s,o.username=s.username,o.email=s.email,o.full_name=s.full_name||"",o.role=s.role,o.description=s.description||"",o.is_active=s.is_active,y.value=!0},J=()=>{var s;o.username="",o.email="",o.password="",o.full_name="",o.role="user",o.description="",o.is_active=!0,E.value=null,(s=S.value)==null||s.resetFields()},K=async()=>{S.value&&await S.value.validate(async s=>{if(s)try{if(z.value=!0,_.value&&E.value){const l={email:o.email,full_name:o.full_name,role:o.role,description:o.description,is_active:o.is_active};await V.updateUser(E.value.id,l),u.success("用户信息已更新")}else await V.createUser({username:o.username,email:o.email,password:o.password,full_name:o.full_name,role:o.role,description:o.description}),u.success("用户创建成功");y.value=!1,await h()}catch(l){u.error(l.message||"操作失败")}finally{z.value=!1}})},W=async s=>{try{await L.confirm(`确定要${s.is_active?"停用":"启用"}用户 "${s.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await V.updateUser(s.id,{is_active:!s.is_active}),u.success(`用户已${s.is_active?"停用":"启用"}`),await h()}catch(l){l!=="cancel"&&u.error("操作失败")}},X=async s=>{try{await L.confirm(`确定要删除用户 "${s.username}" 吗？此操作不可恢复。`,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}),await V.deleteUser(s.id),u.success("用户已删除"),await h()}catch(l){l!=="cancel"&&u.error("删除失败")}};return ye(async()=>{await h()}),(s,l)=>{const r=n("Refresh"),p=n("el-icon"),f=n("el-button"),Z=n("Plus"),ee=n("Search"),b=n("el-input"),c=n("el-option"),D=n("el-select"),M=n("el-card"),le=n("el-skeleton"),ae=n("User"),te=n("el-avatar"),v=n("el-table-column"),A=n("el-tag"),oe=n("Edit"),F=n("el-tooltip"),se=n("Switch"),ne=n("Delete"),ie=n("el-empty"),re=n("el-table"),g=n("el-form-item"),de=n("el-switch"),ue=n("el-form"),ce=n("el-dialog");return $(),N("div",Ve,[i("div",xe,[l[14]||(l[14]=i("div",{class:"header-content"},[i("h1",null,"用户管理"),i("p",null,"管理系统用户，查看用户信息和状态")],-1)),i("div",Ue,[e(f,{onClick:O,loading:x.value},{default:a(()=>[e(p,null,{default:a(()=>[e(r)]),_:1}),l[12]||(l[12]=m(" 刷新 "))]),_:1,__:[12]},8,["loading"]),e(f,{type:"primary",onClick:j},{default:a(()=>[e(p,null,{default:a(()=>[e(Z)]),_:1}),l[13]||(l[13]=m(" 创建用户 "))]),_:1,__:[13]})])]),e(M,{shadow:"never",class:"search-card"},{default:a(()=>[i("div",Ce,[e(b,{modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=t=>U.value=t),placeholder:"搜索用户名或邮箱",clearable:"",style:{width:"300px"},onInput:Q},{prefix:a(()=>[e(p,null,{default:a(()=>[e(ee)]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=t=>C.value=t),placeholder:"用户状态",clearable:"",style:{width:"150px"},onChange:q},{default:a(()=>[e(c,{label:"全部",value:""}),e(c,{label:"活跃",value:"active"}),e(c,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"]),e(D,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=t=>k.value=t),placeholder:"用户角色",clearable:"",style:{width:"150px"},onChange:q},{default:a(()=>[e(c,{label:"全部",value:""}),e(c,{label:"管理员",value:"admin"}),e(c,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])])]),_:1}),e(M,{shadow:"never"},{default:a(()=>[x.value?($(),N("div",ke,[e(le,{rows:8,animated:""})])):($(),Y(re,{key:1,data:G.value,style:{width:"100%"},"row-key":"id"},{empty:a(()=>[e(ie,{description:"暂无用户数据"})]),default:a(()=>[e(v,{prop:"username",label:"用户名","min-width":"120"},{default:a(({row:t})=>[i("div",Ee,[e(te,{size:32},{default:a(()=>[e(p,null,{default:a(()=>[e(ae)]),_:1})]),_:1}),i("div",Se,[i("div",Be,w(t.username),1),i("div",$e,w(t.full_name||"-"),1)])])]),_:1}),e(v,{prop:"email",label:"邮箱","min-width":"200","show-overflow-tooltip":""}),e(v,{prop:"role",label:"角色",width:"100"},{default:a(({row:t})=>[e(A,{type:t.role==="admin"?"danger":"primary",size:"small"},{default:a(()=>[m(w(t.role==="admin"?"管理员":"用户"),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"is_active",label:"状态",width:"80"},{default:a(({row:t})=>[e(A,{type:t.is_active?"success":"danger",size:"small"},{default:a(()=>[m(w(t.is_active?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"created_at",label:"注册时间",width:"160"},{default:a(({row:t})=>[m(w(R(_e)(t.created_at,"YYYY-MM-DD")),1)]),_:1}),e(v,{prop:"updated_at",label:"最后更新",width:"160"},{default:a(({row:t})=>[m(w(R(pe)(t.updated_at)),1)]),_:1}),e(v,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[i("div",ze,[e(F,{content:"编辑"},{default:a(()=>[e(f,{size:"small",text:"",onClick:B=>H(t)},{default:a(()=>[e(p,null,{default:a(()=>[e(oe)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),e(F,{content:t.is_active?"停用":"启用"},{default:a(()=>[e(f,{size:"small",text:"",type:t.is_active?"warning":"success",onClick:B=>W(t)},{default:a(()=>[e(p,null,{default:a(()=>[e(se)]),_:1})]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),e(F,{content:"删除"},{default:a(()=>{var B;return[e(f,{size:"small",text:"",type:"danger",onClick:qe=>X(t),disabled:t.id===((B=R(I).user)==null?void 0:B.id)},{default:a(()=>[e(p,null,{default:a(()=>[e(ne)]),_:1})]),_:2},1032,["onClick","disabled"])]}),_:2},1024)])]),_:1})]),_:1},8,["data"]))]),_:1}),e(ce,{modelValue:y.value,"onUpdate:modelValue":l[11]||(l[11]=t=>y.value=t),title:_.value?"编辑用户":"创建用户",width:"500px",onClose:J},{footer:a(()=>[i("div",De,[e(f,{onClick:l[10]||(l[10]=t=>y.value=!1)},{default:a(()=>l[15]||(l[15]=[m("取消")])),_:1,__:[15]}),e(f,{type:"primary",loading:z.value,onClick:K},{default:a(()=>[m(w(_.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[e(ue,{ref_key:"formRef",ref:S,model:o,rules:P,"label-width":"80px"},{default:a(()=>[e(g,{label:"用户名",prop:"username"},{default:a(()=>[e(b,{modelValue:o.username,"onUpdate:modelValue":l[3]||(l[3]=t=>o.username=t),placeholder:"请输入用户名",disabled:_.value,maxlength:"50","show-word-limit":""},null,8,["modelValue","disabled"])]),_:1}),e(g,{label:"邮箱",prop:"email"},{default:a(()=>[e(b,{modelValue:o.email,"onUpdate:modelValue":l[4]||(l[4]=t=>o.email=t),type:"email",placeholder:"请输入邮箱",maxlength:"255"},null,8,["modelValue"])]),_:1}),_.value?be("",!0):($(),Y(g,{key:0,label:"密码",prop:"password"},{default:a(()=>[e(b,{modelValue:o.password,"onUpdate:modelValue":l[5]||(l[5]=t=>o.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),e(g,{label:"姓名",prop:"full_name"},{default:a(()=>[e(b,{modelValue:o.full_name,"onUpdate:modelValue":l[6]||(l[6]=t=>o.full_name=t),placeholder:"请输入姓名（可选）",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(g,{label:"角色",prop:"role"},{default:a(()=>[e(D,{modelValue:o.role,"onUpdate:modelValue":l[7]||(l[7]=t=>o.role=t),placeholder:"选择用户角色",style:{width:"100%"}},{default:a(()=>[e(c,{label:"普通用户",value:"user"}),e(c,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"状态",prop:"is_active"},{default:a(()=>[e(de,{modelValue:o.is_active,"onUpdate:modelValue":l[8]||(l[8]=t=>o.is_active=t),"active-text":"活跃","inactive-text":"停用"},null,8,["modelValue"])]),_:1}),e(g,{label:"描述",prop:"description"},{default:a(()=>[e(b,{modelValue:o.description,"onUpdate:modelValue":l[9]||(l[9]=t=>o.description=t),type:"textarea",rows:3,placeholder:"用户描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Pe=he(Fe,[["__scopeId","data-v-a3c9eacf"]]);export{Pe as default};
